{"expireTime":9007200815377755000,"key":"transformer-remark-markdown-html-348b634244231e363c37f0981c3c6de8-gatsby-remark-katexgatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-autolink-headersgatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":"<p>Hello! Per request of a friendly reddit user, I’m going to be doing a quick tutorial on using firebase with swift and how to structure your data models. Before we do anything, just a quick disclaimer, this tutorial is in swift 3, which, even though my life would be made much easier had I used swift 4 (google codeable swift 4), is the current default.</p>\n<p>Basic project setup:</p>\n<ul>\n<li>Single page application default in XCode</li>\n<li>Cocoapods to install Firebase</li>\n</ul>\n<p>You’ll be able to find the project’s link at the end of this guide.</p>\n<p>This app is going to be dumb simple:</p>\n<ul>\n<li>A list of items</li>\n<li>Click on item to view info or delete</li>\n<li>\n<ul>\n<li>button in the top corner to add one</li>\n</ul>\n</li>\n</ul>\n<p>The first piece of code for this pattern is a simple protocol:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token builtin\">FirebaseItem</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> id<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span> <span class=\"token keyword\">set</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">var</span> name<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span> <span class=\"token keyword\">set</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">String</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">AnyObject</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>fromFirebaseItem<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FIRDataSnapshot</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>For the most part every firebase item we’ll have will have an ID and a name. Very simply, every item we construct needs to be able to produce a JSON object, and must be able to be constructed from a firebase item.</p>\n<p>Following Firebase’s standards we’re going to avoid nesting our data, and keep it very simple.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"items\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"first\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"first\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"Apple\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"price\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">3</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"second\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"id\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"second\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"name\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"Banana\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"price\"</span> <span class=\"token operator\">:</span> <span class=\"token number\">3</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now that that’s working, let’s setup the class that’s going to get our data</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">FirebaseInitialization</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> childRef<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FIRDatabaseReference</span><span class=\"token operator\">!</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> items<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">FirebaseItem</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    \n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> ref <span class=\"token operator\">=</span> <span class=\"token builtin\">FIRDatabase</span><span class=\"token punctuation\">.</span><span class=\"token function\">database</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reference</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        childRef <span class=\"token operator\">=</span> ref<span class=\"token punctuation\">.</span><span class=\"token function\">child</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"items\"</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">let</span> addFunc <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span><span class=\"token builtin\">FIRDataSnapshot</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token function\">GroceryItem</span><span class=\"token punctuation\">(</span>fromFirebaseItem<span class=\"token punctuation\">:</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">let</span> removeFunc <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FIRDataSnapshot</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">where</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Bool</span> <span class=\"token keyword\">in</span>\n                item<span class=\"token punctuation\">.</span>id <span class=\"token operator\">==</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span>forKey<span class=\"token punctuation\">:</span> <span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">String</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>at<span class=\"token punctuation\">:</span> index<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        childRef<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">FIRDataEventType</span><span class=\"token punctuation\">.</span>childAdded<span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> addFunc<span class=\"token punctuation\">)</span>\n        childRef<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">FIRDataEventType</span><span class=\"token punctuation\">.</span>childRemoved<span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> removeFunc<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function\">getItems</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">FirebaseItem</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> items\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Again, very simple: we connect to the database and setup the things that will automatically add and remove from our internal list. Finally let’s look at our UITableViewController</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">GroceryListTableViewController</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableViewController</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token keyword\">var</span> firebase<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FirebaseInitialization</span><span class=\"token operator\">?</span>\n    <span class=\"token keyword\">var</span> items<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">FirebaseItem</span><span class=\"token punctuation\">]</span><span class=\"token operator\">?</span>\n    \n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">viewDidLoad</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        \n        firebase <span class=\"token operator\">=</span> <span class=\"token function\">FirebaseInitialization</span><span class=\"token punctuation\">(</span>delegate<span class=\"token punctuation\">:</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span>\n        items <span class=\"token operator\">=</span> firebase<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token function\">getItems</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">didReceiveMemoryWarning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// MARK: - Table view data source</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">numberOfSections</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Int</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// #warning Incomplete implementation, return the number of sections</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">1</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> numberOfRowsInSection section<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Int</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> items<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">count</span>\n    <span class=\"token punctuation\">}</span>\n\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> cellForRowAt indexPath<span class=\"token punctuation\">:</span> <span class=\"token builtin\">IndexPath</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">UITableViewCell</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> cell <span class=\"token operator\">=</span> tableView<span class=\"token punctuation\">.</span><span class=\"token function\">dequeueReusableCell</span><span class=\"token punctuation\">(</span>withIdentifier<span class=\"token punctuation\">:</span> <span class=\"token string\">\"groceryItem\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">for</span><span class=\"token punctuation\">:</span> indexPath<span class=\"token punctuation\">)</span>\n        cell<span class=\"token punctuation\">.</span>textLabel<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>text <span class=\"token operator\">=</span> items<span class=\"token operator\">!</span><span class=\"token punctuation\">[</span>indexPath<span class=\"token punctuation\">.</span>row<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>name\n        <span class=\"token keyword\">return</span> cell\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> didSelectRowAt indexPath<span class=\"token punctuation\">:</span> <span class=\"token builtin\">IndexPath</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>items<span class=\"token operator\">?</span><span class=\"token punctuation\">[</span>indexPath<span class=\"token punctuation\">.</span>row<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        tableView<span class=\"token punctuation\">.</span><span class=\"token function\">deselectRow</span><span class=\"token punctuation\">(</span>at<span class=\"token punctuation\">:</span> indexPath<span class=\"token punctuation\">,</span> animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now we initialize our firebase class, and set the list of items. What’s very important is that we reload our data when we get new data. With Async behavior this step is very important.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token builtin\">FirebaseTableDelegate</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">reloadData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>It’s very easy to do this with the delegate pattern.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">FirebaseInitialization</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> childRef<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FIRDatabaseReference</span><span class=\"token operator\">!</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> items<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">FirebaseItem</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> delegate<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FirebaseTableDelegate</span>\n    \n    <span class=\"token keyword\">init</span><span class=\"token punctuation\">(</span>delegate<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FirebaseTableDelegate</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>delegate <span class=\"token operator\">=</span> delegate\n        <span class=\"token keyword\">let</span> ref <span class=\"token operator\">=</span> <span class=\"token builtin\">FIRDatabase</span><span class=\"token punctuation\">.</span><span class=\"token function\">database</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reference</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        childRef <span class=\"token operator\">=</span> ref<span class=\"token punctuation\">.</span><span class=\"token function\">child</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"items\"</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">let</span> addFunc <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span><span class=\"token builtin\">FIRDataSnapshot</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token function\">GroceryItem</span><span class=\"token punctuation\">(</span>fromFirebaseItem<span class=\"token punctuation\">:</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            delegate<span class=\"token punctuation\">.</span><span class=\"token function\">reloadData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">let</span> removeFunc <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FIRDataSnapshot</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">where</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Bool</span> <span class=\"token keyword\">in</span>\n                item<span class=\"token punctuation\">.</span>id <span class=\"token operator\">==</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span>forKey<span class=\"token punctuation\">:</span> <span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">String</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>at<span class=\"token punctuation\">:</span> index<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n            delegate<span class=\"token punctuation\">.</span><span class=\"token function\">reloadData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        childRef<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">FIRDataEventType</span><span class=\"token punctuation\">.</span>childAdded<span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> addFunc<span class=\"token punctuation\">)</span>\n        childRef<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">FIRDataEventType</span><span class=\"token punctuation\">.</span>childRemoved<span class=\"token punctuation\">,</span> with<span class=\"token punctuation\">:</span> removeFunc<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">func</span> <span class=\"token function\">getItems</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">FirebaseItem</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> items\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>and finally:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">GroceryListTableViewController</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">FirebaseTableDelegate</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">reloadData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        items <span class=\"token operator\">=</span> firebase<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">getItems</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>tableView<span class=\"token punctuation\">.</span><span class=\"token function\">reloadData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now automatically, every time an item is added or removed from our database the tableview will automatically reload. For a small application like this, this pattern is perfect; very extendable and very easy to understand. Now let’s see how easy it is to add a new item.</p>\n<p>First, in our table view controller</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">    <span class=\"token atrule\">@IBAction</span> <span class=\"token keyword\">func</span> <span class=\"token function\">addItem</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> sender<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> alert <span class=\"token operator\">=</span> <span class=\"token function\">UIAlertController</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Add Item\"</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Add an item to grocery list\"</span><span class=\"token punctuation\">,</span> preferredStyle<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>alert<span class=\"token punctuation\">)</span>\n        \n        alert<span class=\"token punctuation\">.</span>addTextField <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>textField<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n            textField<span class=\"token punctuation\">.</span>placeholder <span class=\"token operator\">=</span> <span class=\"token string\">\"Name\"</span>\n        <span class=\"token punctuation\">}</span>\n        \n        alert<span class=\"token punctuation\">.</span>addTextField <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>textField<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n            textField<span class=\"token punctuation\">.</span>placeholder <span class=\"token operator\">=</span> <span class=\"token string\">\"Price\"</span>\n            textField<span class=\"token punctuation\">.</span>keyboardType <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span>decimalPad\n        <span class=\"token punctuation\">}</span>\n        alert<span class=\"token punctuation\">.</span><span class=\"token function\">addAction</span><span class=\"token punctuation\">(</span><span class=\"token function\">UIAlertAction</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Add\"</span><span class=\"token punctuation\">,</span> style<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span><span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">weak</span> alert<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span><span class=\"token number\">_</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">let</span> nameTextField <span class=\"token operator\">=</span> alert<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>textFields<span class=\"token operator\">!</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n            <span class=\"token keyword\">let</span> priceTextField <span class=\"token operator\">=</span> alert<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>textFields<span class=\"token operator\">!</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n            <span class=\"token keyword\">let</span> price <span class=\"token operator\">=</span> <span class=\"token function\">Double</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>priceTextField<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">let</span> uuid <span class=\"token operator\">=</span> <span class=\"token function\">UUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>uuidString\n            <span class=\"token keyword\">let</span> item <span class=\"token operator\">=</span> <span class=\"token function\">GroceryItem</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">:</span> uuid<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>nameTextField<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> price<span class=\"token punctuation\">:</span> price<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>firebase<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">addItem</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">)</span>\n            \n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        alert<span class=\"token punctuation\">.</span><span class=\"token function\">addAction</span><span class=\"token punctuation\">(</span><span class=\"token function\">UIAlertAction</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Cancel\"</span><span class=\"token punctuation\">,</span> style<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>cancel<span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n            <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cancel\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">present</span><span class=\"token punctuation\">(</span>alert<span class=\"token punctuation\">,</span> animated<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n            <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"done\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>And lastly in FirebaseInitialization</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">    <span class=\"token keyword\">func</span> <span class=\"token function\">addItem</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FirebaseItem</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        childRef<span class=\"token punctuation\">.</span><span class=\"token function\">child</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>As you can see it’s incredibely easy to implement this if you wanted to create a new class. What’s also useful is that there are no strong ties to firebase from the table view. Please let me know what you think on reddit!</p>\n<p>UPDATE</p>\n<p>code to remove items: </p>\n<p>In our FirebaseInitialization class</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> removeFunc <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FIRDataSnapshot</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">where</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Bool</span> <span class=\"token keyword\">in</span>\n                <span class=\"token keyword\">let</span> properties <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>value <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token builtin\">NSDictionary</span>\n                <span class=\"token keyword\">return</span> item<span class=\"token punctuation\">.</span>id <span class=\"token operator\">==</span> properties<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span>forKey<span class=\"token punctuation\">:</span> <span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span><span class=\"token operator\">!</span> <span class=\"token builtin\">String</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>at<span class=\"token punctuation\">:</span> index<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n            delegate<span class=\"token punctuation\">.</span><span class=\"token function\">reloadData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">removeItem</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    childRef<span class=\"token punctuation\">.</span><span class=\"token function\">child</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">removeValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And in our UITableViewController</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function\">tableView</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> tableView<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableView</span><span class=\"token punctuation\">,</span> commit editingStyle<span class=\"token punctuation\">:</span> <span class=\"token builtin\">UITableViewCellEditingStyle</span><span class=\"token punctuation\">,</span> forRowAt indexPath<span class=\"token punctuation\">:</span> <span class=\"token builtin\">IndexPath</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> editingStyle <span class=\"token operator\">==</span> <span class=\"token punctuation\">.</span>delete <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> groceryItem <span class=\"token operator\">=</span> items<span class=\"token operator\">?</span><span class=\"token punctuation\">[</span>indexPath<span class=\"token punctuation\">.</span>row<span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>firebase<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">removeItem</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>groceryItem<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As you can see adding functionality is quite simple.</p>\n<p>UPDATE 2:</p>\n<p>Models within models</p>\n<p>If you have json within json, as long as that piece of data implements the <code class=\"language-text\">FirebaseItem</code> protocol, all you have to do is call the <code class=\"language-text\">getJSON()</code> method. Because of the type system, this simple approach allows us to do whatever we want. What’s also great about this is that if you have a sub model that then has another object within it, all you have to do is call that item’s <code class=\"language-text\">getJSON()</code> method within that sub-model’s method.</p>\n<p><a href=\"https://github.com/jaronoff97/FirebasePlayground/tree/data_modeling\">github</a></p>"}